<!DOCTYPE html><html class=no-js lang=en> <head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><meta content="Scraping Facebook Marketplace Vehicle Listings in Canada" name=description><meta content="Harminder Singh Nijjar" name=author><link href=https://harminder.dev/projects/web-scraping/facebook/facebook-marketplace/smartproxy-facebook-marketplace-scraper/ rel=canonical><link href=../oxylabs-facebook-marketplace-scraper/ rel=prev><link href=../../../../websites/vercel/gitbute/3d-github-contributions/3d-github-contributions/ rel=next><link href=https://raw.githubusercontent.com/harmindersinghnijjar/face/main/fotor_2023-8-13_21_49_31-fotor-2023081322615.png rel=icon><meta content="mkdocs-1.5.3, mkdocs-material-9.4.14" name=generator><title>Smartproxy Facebook Marketplace Scraper - Harminder Singh Nijjar</title><link href=../../../../../assets/stylesheets/main.fad675c6.min.css rel=stylesheet><link href=../../../../../assets/stylesheets/palette.356b1318.min.css rel=stylesheet><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback" rel=stylesheet><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href=../../../../../assets/_mkdocstrings.css rel=stylesheet><link href=../../../../../css/tailwind.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/flowbite@1.0.0/dist/flowbite.min.css rel=stylesheet><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel=stylesheet><link href=../../../../../css/custom.css rel=stylesheet><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-X0B1C5DM9K"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-X0B1C5DM9K",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-X0B1C5DM9K",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><meta content="Smartproxy Facebook Marketplace Scraper" name=title><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css rel=stylesheet><meta content=website property=og:type><meta content=https://harminder.dev/projects/web-scraping/facebook/facebook-marketplace/smartproxy-facebook-marketplace-scraper property=og:url><meta content="Smartproxy Facebook Marketplace Scraper" property=og:title><meta content="Scraping Facebook Marketplace Vehicle Listings in Canada" property=og:description><meta content=https://github.com/harmindersinghnijjar/face/blob/main/fotor_2023-8-13_21_49_31-fotor-2023081322615.png property=og:image><meta content=summary_large_image property=twitter:card><meta content=https://harminder.dev/projects/web-scraping/facebook/facebook-marketplace/smartproxy-facebook-marketplace-scraper property=twitter:url><meta content="Smartproxy Facebook Marketplace Scraper" property=twitter:title><meta content="Scraping Facebook Marketplace Vehicle Listings in Canada" property=twitter:description><meta content=https://github.com/harmindersinghnijjar/face/blob/main/fotor_2023-8-13_21_49_31-fotor-2023081322615.png property=twitter:image></head> <body data-md-color-accent=indigo data-md-color-primary=indigo data-md-color-scheme=default dir=ltr> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input autocomplete=off class=md-toggle data-md-toggle=drawer id=__drawer type=checkbox> <input autocomplete=off class=md-toggle data-md-toggle=search id=__search type=checkbox> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a class=md-skip href=#advanced-python-scripting-scraping-and-storing-facebook-marketplace-vehicle-listings-in-canada> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav aria-label=Header class="md-header__inner md-grid"> <a aria-label="Harminder Singh Nijjar" class="md-header__button md-logo" data-md-component=logo href=../../../../.. title="Harminder Singh Nijjar"> <img alt=logo src=https://raw.githubusercontent.com/harmindersinghnijjar/face/main/fotor_2023-8-13_21_49_31-fotor-2023081322615.png> </a> <label class="md-header__button md-icon" for=__drawer> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Harminder Singh Nijjar </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Smartproxy Facebook Marketplace Scraper </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input aria-label="Switch to light mode" class=md-option data-md-color-accent=indigo data-md-color-media=(prefers-color-scheme) data-md-color-primary=indigo data-md-color-scheme=default id=__palette_1 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_3 hidden title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"></path></svg> </label> <input aria-label="Switch to dark mode" class=md-option data-md-color-accent=indigo data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary=indigo data-md-color-scheme=default id=__palette_2 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_1 hidden title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg> </label> <input aria-label="Switch to system preference" class=md-option data-md-color-accent=indigo data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary=indigo data-md-color-scheme=slate id=__palette_3 name=__palette type=radio> <label class="md-header__button md-icon" for=__palette_2 hidden title="Switch to system preference"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input aria-label=Search autocapitalize=off autocomplete=off autocorrect=off class=md-search__input data-md-component=search-query name=query placeholder=Search required spellcheck=false type=text> <label class="md-search__icon md-icon" for=__search> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </label> <nav aria-label=Search class=md-search__options> <a aria-label=Share class="md-search__icon md-icon" data-clipboard data-clipboard-text data-md-component=search-share href=javascript:void(0) tabindex=-1 title=Share> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"></path></svg> </a> <button aria-label=Clear class="md-search__icon md-icon" tabindex=-1 title=Clear type=reset> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> <nav aria-label=Tabs class=md-tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a class=md-tabs__link href=../../../../..> Home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../../ class=md-tabs__link> Projects </a> </li> <li class=md-tabs__item> <a href=../../../../../areas/ class=md-tabs__link> Areas </a> </li> <li class=md-tabs__item> <a href=../../../../../blog/ class=md-tabs__link> Blog </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label=Navigation class="md-nav md-nav--primary md-nav--lifted" data-md-level=0> <label class=md-nav__title for=__drawer> <a aria-label="Harminder Singh Nijjar" class="md-nav__button md-logo" data-md-component=logo href=../../../../.. title="Harminder Singh Nijjar"> <img alt=logo src=https://raw.githubusercontent.com/harmindersinghnijjar/face/main/fotor_2023-8-13_21_49_31-fotor-2023081322615.png> </a> Harminder Singh Nijjar </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=../../../../..> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" id=__nav_2 type=checkbox> <div class="md-nav__link md-nav__container"> <a href=../../../../ class=md-nav__link> <span class=md-ellipsis> Projects </span> </a> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded=true aria-labelledby=__nav_2_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Projects </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2_2 type=checkbox> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> AI-Powered Property Surveillance </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_2_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> AI-Powered Property Surveillance </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../ai-powered-property-surveillance/training/ class=md-nav__link> <span class=md-ellipsis> Training YOLOV8 on DVR footage </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2_3 type=checkbox> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> Dubbing pipeline </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_3_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Dubbing pipeline </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../dubbing-pipeline/dub-with-elevenlabs/ class=md-nav__link> <span class=md-ellipsis> Dub with ElevenLabs Google Chrome Extension </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2_4 type=checkbox> <label class=md-nav__link for=__nav_2_4 id=__nav_2_4_label tabindex=0> <span class=md-ellipsis> Midjourney Automation Bot </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_4_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_4> <span class="md-nav__icon md-icon"></span> Midjourney Automation Bot </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2_4_1 type=checkbox> <label class=md-nav__link for=__nav_2_4_1 id=__nav_2_4_1_label tabindex=0> <span class=md-ellipsis> Wiki </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_4_1_label class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_4_1> <span class="md-nav__icon md-icon"></span> Wiki </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../midjourney-automation-bot/wiki/midjourney-automation-bot-overview/ class=md-nav__link> <span class=md-ellipsis> Midjourney Automation Bot </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2_4_1_2 type=checkbox> <label class=md-nav__link for=__nav_2_4_1_2 id=__nav_2_4_1_2_label tabindex=0> <span class=md-ellipsis> Features </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_4_1_2_label class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_2_4_1_2> <span class="md-nav__icon md-icon"></span> Features </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2_4_1_2_1 type=checkbox> <label class=md-nav__link for=__nav_2_4_1_2_1 id=__nav_2_4_1_2_1_label tabindex=0> <span class=md-ellipsis> Requested features </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_4_1_2_1_label class=md-nav data-md-level=5> <label class=md-nav__title for=__nav_2_4_1_2_1> <span class="md-nav__icon md-icon"></span> Requested features </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../midjourney-automation-bot/wiki/features/requested-features/automated-instagram-image-uploading-with-advanced-captioning/ class=md-nav__link> <span class=md-ellipsis> Automated Instagram image uploading with advanced captioning </span> </a> </li> <li class=md-nav__item> <a href=../../../../midjourney-automation-bot/wiki/features/requested-features/improved-documentation/ class=md-nav__link> <span class=md-ellipsis> Improved Documentation </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2_5 type=checkbox> <label class=md-nav__link for=__nav_2_5 id=__nav_2_5_label tabindex=0> <span class=md-ellipsis> RAG AI Assistant </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_5_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_5> <span class="md-nav__icon md-icon"></span> RAG AI Assistant </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../rag-ai-assistant/rag-ai-assistant/ class=md-nav__link> <span class=md-ellipsis> RAG AI Assistant </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2_6 type=checkbox> <label class=md-nav__link for=__nav_2_6 id=__nav_2_6_label tabindex=0> <span class=md-ellipsis> Social media automation </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_6_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_6> <span class="md-nav__icon md-icon"></span> Social media automation </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2_6_1 type=checkbox> <label class=md-nav__link for=__nav_2_6_1 id=__nav_2_6_1_label tabindex=0> <span class=md-ellipsis> Instagram </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_6_1_label class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_6_1> <span class="md-nav__icon md-icon"></span> Instagram </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../social-media-automation/instagram/unfollowing-non-followers/unfollowing-non-followers/ class=md-nav__link> <span class=md-ellipsis> Unfollowing non-followers </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2_6_2 type=checkbox> <label class=md-nav__link for=__nav_2_6_2 id=__nav_2_6_2_label tabindex=0> <span class=md-ellipsis> Truth Social </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_6_2_label class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_6_2> <span class="md-nav__icon md-icon"></span> Truth Social </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2_6_2_1 type=checkbox> <label class=md-nav__link for=__nav_2_6_2_1 id=__nav_2_6_2_1_label tabindex=0> <span class=md-ellipsis> Account cloning </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_6_2_1_label class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_2_6_2_1> <span class="md-nav__icon md-icon"></span> Account cloning </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../social-media-automation/truth-social/account-cloning/downloading-media/downloading-media/ class=md-nav__link> <span class=md-ellipsis> Downloading media </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" id=__nav_2_7 type=checkbox> <label class=md-nav__link for=__nav_2_7 id=__nav_2_7_label tabindex=0> <span class=md-ellipsis> Web scraping </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=true aria-labelledby=__nav_2_7_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_7> <span class="md-nav__icon md-icon"></span> Web scraping </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../web-scraping-overview/ class=md-nav__link> <span class=md-ellipsis> Web scraping overview </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" id=__nav_2_7_2 type=checkbox> <label class=md-nav__link for=__nav_2_7_2 id=__nav_2_7_2_label tabindex=0> <span class=md-ellipsis> Facebook </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=true aria-labelledby=__nav_2_7_2_label class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_7_2> <span class="md-nav__icon md-icon"></span> Facebook </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked class="md-nav__toggle md-toggle" id=__nav_2_7_2_1 type=checkbox> <label class=md-nav__link for=__nav_2_7_2_1 id=__nav_2_7_2_1_label tabindex=0> <span class=md-ellipsis> Facebook Marketplace </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=true aria-labelledby=__nav_2_7_2_1_label class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_2_7_2_1> <span class="md-nav__icon md-icon"></span> Facebook Marketplace </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../bright-data-facebook-marketplace-scraper/ class=md-nav__link> <span class=md-ellipsis> Bright Data Facebook Marketplace Scraper </span> </a> </li> <li class=md-nav__item> <a href=../oxylabs-facebook-marketplace-scraper/ class=md-nav__link> <span class=md-ellipsis> Oxylabs Facebook Marketplace Scraper </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" id=__toc type=checkbox> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Smartproxy Facebook Marketplace Scraper </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Smartproxy Facebook Marketplace Scraper </span> </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#introduction> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-concept> <span class=md-ellipsis> The Concept </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#technical-breakdown> <span class=md-ellipsis> Technical Breakdown </span> </a> <nav aria-label="Technical Breakdown" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#core-technologies> <span class=md-ellipsis> Core Technologies </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#script-structure> <span class=md-ellipsis> Script Structure </span> </a> <nav aria-label="Script Structure" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#databasemanager-class> <span class=md-ellipsis> DatabaseManager Class </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#facebookmarketplacescraper-class> <span class=md-ellipsis> FacebookMarketplaceScraper Class </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#asynchronous-operation> <span class=md-ellipsis> Asynchronous Operation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#deep-dive-into-code> <span class=md-ellipsis> Deep Dive into Code </span> </a> <nav aria-label="Deep Dive into Code" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#setting-up-logging> <span class=md-ellipsis> Setting Up Logging </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#database-operations> <span class=md-ellipsis> Database Operations </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#data-scraping-and-parsing> <span class=md-ellipsis> Data Scraping and Parsing </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#handling-asynchronous-tasks> <span class=md-ellipsis> Handling Asynchronous Tasks </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#usage-scenario> <span class=md-ellipsis> Usage Scenario </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#challenges-and-solutions> <span class=md-ellipsis> Challenges and Solutions </span> </a> <nav aria-label="Challenges and Solutions" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#challenge-scraping-dynamic-content> <span class=md-ellipsis> Challenge: Scraping Dynamic Content </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#solution-smartproxy> <span class=md-ellipsis> Solution: Smartproxy </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#challenge-parsing-html-content> <span class=md-ellipsis> Challenge: Parsing HTML Content </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#solution-regular-expressions> <span class=md-ellipsis> Solution: Regular Expressions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#challenge-data-storage> <span class=md-ellipsis> Challenge: Data Storage </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#solution-databasemanager-class> <span class=md-ellipsis> Solution: DatabaseManager Class </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#future-enhancements> <span class=md-ellipsis> Future Enhancements </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#conclusion> <span class=md-ellipsis> Conclusion </span> </a> <nav aria-label=Conclusion class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#github-repository> <span class=md-ellipsis> GitHub Repository </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#disclaimer> <span class=md-ellipsis> Disclaimer </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2_8 type=checkbox> <label class=md-nav__link for=__nav_2_8 id=__nav_2_8_label tabindex=0> <span class=md-ellipsis> Websites </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_8_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_2_8> <span class="md-nav__icon md-icon"></span> Websites </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2_8_1 type=checkbox> <label class=md-nav__link for=__nav_2_8_1 id=__nav_2_8_1_label tabindex=0> <span class=md-ellipsis> Vercel </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_8_1_label class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_8_1> <span class="md-nav__icon md-icon"></span> Vercel </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2_8_1_1 type=checkbox> <label class=md-nav__link for=__nav_2_8_1_1 id=__nav_2_8_1_1_label tabindex=0> <span class=md-ellipsis> GitBute </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_8_1_1_label class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_2_8_1_1> <span class="md-nav__icon md-icon"></span> GitBute </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../websites/vercel/gitbute/3d-github-contributions/3d-github-contributions/ class=md-nav__link> <span class=md-ellipsis> 3D GitHub Contributions </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2_8_2 type=checkbox> <label class=md-nav__link for=__nav_2_8_2 id=__nav_2_8_2_label tabindex=0> <span class=md-ellipsis> MkDocs </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_8_2_label class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_2_8_2> <span class="md-nav__icon md-icon"></span> MkDocs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2_8_2_1 type=checkbox> <label class=md-nav__link for=__nav_2_8_2_1 id=__nav_2_8_2_1_label tabindex=0> <span class=md-ellipsis> Adding Assets </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_8_2_1_label class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_2_8_2_1> <span class="md-nav__icon md-icon"></span> Adding Assets </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_2_8_2_1_1 type=checkbox> <label class=md-nav__link for=__nav_2_8_2_1_1 id=__nav_2_8_2_1_1_label tabindex=0> <span class=md-ellipsis> Additional CSS </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_2_8_2_1_1_label class=md-nav data-md-level=5> <label class=md-nav__title for=__nav_2_8_2_1_1> <span class="md-nav__icon md-icon"></span> Additional CSS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../websites/mkdocs/knowledge-base/adding-assets/additional-css/tailwind-css/setup-material-mkdocs-insiders-tailwind/ class=md-nav__link> <span class=md-ellipsis> Tailwind CSS </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3 type=checkbox> <div class="md-nav__link md-nav__container"> <a href=../../../../../areas/ class=md-nav__link> <span class=md-ellipsis> Areas </span> </a> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded=false aria-labelledby=__nav_3_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Areas </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_2 type=checkbox> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class=md-ellipsis> Culture and arts </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_2_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Culture and arts </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_2_1 type=checkbox> <label class=md-nav__link for=__nav_3_2_1 id=__nav_3_2_1_label tabindex=0> <span class=md-ellipsis> Recreation and entertainment </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_2_1_label class=md-nav data-md-level=3> <label class=md-nav__title for=__nav_3_2_1> <span class="md-nav__icon md-icon"></span> Recreation and entertainment </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_2_1_1 type=checkbox> <label class=md-nav__link for=__nav_3_2_1_1 id=__nav_3_2_1_1_label tabindex=0> <span class=md-ellipsis> Games </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_2_1_1_label class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_3_2_1_1> <span class="md-nav__icon md-icon"></span> Games </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_2_1_1_1 type=checkbox> <label class=md-nav__link for=__nav_3_2_1_1_1 id=__nav_3_2_1_1_1_label tabindex=0> <span class=md-ellipsis> Sports </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_2_1_1_1_label class=md-nav data-md-level=5> <label class=md-nav__title for=__nav_3_2_1_1_1> <span class="md-nav__icon md-icon"></span> Sports </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_2_1_1_1_1 type=checkbox> <label class=md-nav__link for=__nav_3_2_1_1_1_1 id=__nav_3_2_1_1_1_1_label tabindex=0> <span class=md-ellipsis> Combat sports </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_2_1_1_1_1_label class=md-nav data-md-level=6> <label class=md-nav__title for=__nav_3_2_1_1_1_1> <span class="md-nav__icon md-icon"></span> Combat sports </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_2_1_1_1_1_1 type=checkbox> <label class=md-nav__link for=__nav_3_2_1_1_1_1_1 id=__nav_3_2_1_1_1_1_1_label tabindex=0> <span class=md-ellipsis> Martial arts </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_2_1_1_1_1_1_label class=md-nav data-md-level=7> <label class=md-nav__title for=__nav_3_2_1_1_1_1_1> <span class="md-nav__icon md-icon"></span> Martial arts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../areas/culture-and-the-arts/recreation-and-entertainment/games/sports/combat-sports/martial-arts/brazilian-jiu-jitsu/brazilian-jiu-jitsu/ class=md-nav__link> <span class=md-ellipsis> Brazilian Jiu-Jitsu </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_2_1_1_2 type=checkbox> <label class=md-nav__link for=__nav_3_2_1_1_2 id=__nav_3_2_1_1_2_label tabindex=0> <span class=md-ellipsis> Video games </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_2_1_1_2_label class=md-nav data-md-level=5> <label class=md-nav__title for=__nav_3_2_1_1_2> <span class="md-nav__icon md-icon"></span> Video games </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_2_1_1_2_1 type=checkbox> <label class=md-nav__link for=__nav_3_2_1_1_2_1 id=__nav_3_2_1_1_2_1_label tabindex=0> <span class=md-ellipsis> Video game hardware platforms </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_2_1_1_2_1_label class=md-nav data-md-level=6> <label class=md-nav__title for=__nav_3_2_1_1_2_1> <span class="md-nav__icon md-icon"></span> Video game hardware platforms </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_2_1_1_2_1_1 type=checkbox> <label class=md-nav__link for=__nav_3_2_1_1_2_1_1 id=__nav_3_2_1_1_2_1_1_label tabindex=0> <span class=md-ellipsis> Cloud gaming </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_2_1_1_2_1_1_label class=md-nav data-md-level=7> <label class=md-nav__title for=__nav_3_2_1_1_2_1_1> <span class="md-nav__icon md-icon"></span> Cloud gaming </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../areas/culture-and-the-arts/recreation-and-entertainment/games/video-games/video-game-hardware-platforms/cloud-gaming/amazon-luna/amazon-luna/ class=md-nav__link> <span class=md-ellipsis> Amazon Luna </span> </a> </li> <li class=md-nav__item> <a href=../../../../../areas/culture-and-the-arts/recreation-and-entertainment/games/video-games/video-game-hardware-platforms/cloud-gaming/netflix-gaming/netflix-gaming/ class=md-nav__link> <span class=md-ellipsis> Netflix Gaming </span> </a> </li> <li class=md-nav__item> <a href=../../../../../areas/culture-and-the-arts/recreation-and-entertainment/games/video-games/video-game-hardware-platforms/cloud-gaming/xbox-cloud-gaming/xbox-cloud-gaming/ class=md-nav__link> <span class=md-ellipsis> Xbox Cloud Gaming </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_2_1_1_2_1_2 type=checkbox> <label class=md-nav__link for=__nav_3_2_1_1_2_1_2 id=__nav_3_2_1_1_2_1_2_label tabindex=0> <span class=md-ellipsis> Console gaming </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_2_1_1_2_1_2_label class=md-nav data-md-level=7> <label class=md-nav__title for=__nav_3_2_1_1_2_1_2> <span class="md-nav__icon md-icon"></span> Console gaming </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_2_1_1_2_1_2_1 type=checkbox> <label class=md-nav__link for=__nav_3_2_1_1_2_1_2_1 id=__nav_3_2_1_1_2_1_2_1_label tabindex=0> <span class=md-ellipsis> Xbox </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_2_1_1_2_1_2_1_label class=md-nav data-md-level=8> <label class=md-nav__title for=__nav_3_2_1_1_2_1_2_1> <span class="md-nav__icon md-icon"></span> Xbox </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_2_1_1_2_1_2_1_1 type=checkbox> <label class=md-nav__link for=__nav_3_2_1_1_2_1_2_1_1 id=__nav_3_2_1_1_2_1_2_1_1_label tabindex=0> <span class=md-ellipsis> Xbox Adaptive Controller </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_2_1_1_2_1_2_1_1_label class=md-nav data-md-level=9> <label class=md-nav__title for=__nav_3_2_1_1_2_1_2_1_1> <span class="md-nav__icon md-icon"></span> Xbox Adaptive Controller </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_2_1_1_2_1_2_1_1_1 type=checkbox> <label class=md-nav__link for=__nav_3_2_1_1_2_1_2_1_1_1 id=__nav_3_2_1_1_2_1_2_1_1_1_label tabindex=0> <span class=md-ellipsis> Charities </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_2_1_1_2_1_2_1_1_1_label class=md-nav data-md-level=10> <label class=md-nav__title for=__nav_3_2_1_1_2_1_2_1_1_1> <span class="md-nav__icon md-icon"></span> Charities </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_2_1_1_2_1_2_1_1_1_1 type=checkbox> <label class=md-nav__link for=__nav_3_2_1_1_2_1_2_1_1_1_1 id=__nav_3_2_1_1_2_1_2_1_1_1_1_label tabindex=0> <span class=md-ellipsis> AbleGamers </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_2_1_1_2_1_2_1_1_1_1_label class=md-nav data-md-level=11> <label class=md-nav__title for=__nav_3_2_1_1_2_1_2_1_1_1_1> <span class="md-nav__icon md-icon"></span> AbleGamers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href="../../../../../areas/culture-and-the-arts/recreation-and-entertainment/games/video-games/video-game-hardware-platforms/console-gaming/xbox-adaptive-controller/charities /the-ablegamers-foundation/titan-one.md"> <span class=md-ellipsis> Titan One </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../areas/culture-and-the-arts/recreation-and-entertainment/games/video-games/video-game-hardware-platforms/console-gaming/xbox-adaptive-controller/charities/warfighter--engaged/ class=md-nav__link> <span class=md-ellipsis> Warfighter Engaged </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../../../areas/culture-and-the-arts/recreation-and-entertainment/games/video-games/video-game-hardware-platforms/mobile-gaming/mobile-games/ class=md-nav__link> <span class=md-ellipsis> Mobile gaming </span> </a> </li> <li class=md-nav__item> <a href=../../../../../areas/culture-and-the-arts/recreation-and-entertainment/games/video-games/video-game-hardware-platforms/web-gaming/web/ class=md-nav__link> <span class=md-ellipsis> Web gaming </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_2_1_2 type=checkbox> <label class=md-nav__link for=__nav_3_2_1_2 id=__nav_3_2_1_2_label tabindex=0> <span class=md-ellipsis> Music </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_2_1_2_label class=md-nav data-md-level=4> <label class=md-nav__title for=__nav_3_2_1_2> <span class="md-nav__icon md-icon"></span> Music </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_3_2_1_2_1 type=checkbox> <label class=md-nav__link for=__nav_3_2_1_2_1 id=__nav_3_2_1_2_1_label tabindex=0> <span class=md-ellipsis> Lofi </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_3_2_1_2_1_label class=md-nav data-md-level=5> <label class=md-nav__title for=__nav_3_2_1_2_1> <span class="md-nav__icon md-icon"></span> Lofi </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../areas/culture-and-the-arts/recreation-and-entertainment/music/lofi/top-100-lofi-songs/ class=md-nav__link> <span class=md-ellipsis> Top 100 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4 type=checkbox> <div class="md-nav__link md-nav__container"> <a href=../../../../../blog/ class=md-nav__link> <span class=md-ellipsis> Blog </span> </a> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav aria-expanded=false aria-labelledby=__nav_4_label class=md-nav data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4_2 type=checkbox> <label class=md-nav__link for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class=md-ellipsis> Archive </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_2_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Archive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../blog/archive/2023/ class=md-nav__link> <span class=md-ellipsis> 2023 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id=__nav_4_3 type=checkbox> <label class=md-nav__link for=__nav_4_3 id=__nav_4_3_label tabindex=0> <span class=md-ellipsis> Categories </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded=false aria-labelledby=__nav_4_3_label class=md-nav data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Categories </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../blog/category/ai/ class=md-nav__link> <span class=md-ellipsis> AI </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/api/ class=md-nav__link> <span class=md-ellipsis> API </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/beautifulsoup/ class=md-nav__link> <span class=md-ellipsis> BeautifulSoup </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/computer-vision/ class=md-nav__link> <span class=md-ellipsis> Computer Vision </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/dvr/ class=md-nav__link> <span class=md-ellipsis> DVR </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/documentation/ class=md-nav__link> <span class=md-ellipsis> Documentation </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/elevenlabs/ class=md-nav__link> <span class=md-ellipsis> ElevenLabs </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/evernote/ class=md-nav__link> <span class=md-ellipsis> Evernote </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/facebook-marketplace-scraper/ class=md-nav__link> <span class=md-ellipsis> Facebook Marketplace Scraper </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/github-copilot/ class=md-nav__link> <span class=md-ellipsis> GitHub Copilot </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/github-pages/ class=md-nav__link> <span class=md-ellipsis> GitHub Pages </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/google-calendar/ class=md-nav__link> <span class=md-ellipsis> Google Calendar </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/google-sheets-api/ class=md-nav__link> <span class=md-ellipsis> Google Sheets API </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/indexing/ class=md-nav__link> <span class=md-ellipsis> Indexing </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/language-model/ class=md-nav__link> <span class=md-ellipsis> Language Model </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/linkedin/ class=md-nav__link> <span class=md-ellipsis> LinkedIn </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/linux/ class=md-nav__link> <span class=md-ellipsis> Linux </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/mkdocs/ class=md-nav__link> <span class=md-ellipsis> MkDocs </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/nvidia/ class=md-nav__link> <span class=md-ellipsis> NVIDIA </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/osrs/ class=md-nav__link> <span class=md-ellipsis> OSRS </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/openai/ class=md-nav__link> <span class=md-ellipsis> OpenAI </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/productivity/ class=md-nav__link> <span class=md-ellipsis> Productivity </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/python/ class=md-nav__link> <span class=md-ellipsis> Python </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/quizzes/ class=md-nav__link> <span class=md-ellipsis> Quizzes </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/raindropio/ class=md-nav__link> <span class=md-ellipsis> Raindrop.io </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/runescape/ class=md-nav__link> <span class=md-ellipsis> Runescape </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/sqlite/ class=md-nav__link> <span class=md-ellipsis> SQLite </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/selenium/ class=md-nav__link> <span class=md-ellipsis> Selenium </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/skill-assessments/ class=md-nav__link> <span class=md-ellipsis> Skill Assessments </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/smartproxy/ class=md-nav__link> <span class=md-ellipsis> Smartproxy </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/static-site-generator/ class=md-nav__link> <span class=md-ellipsis> Static Site Generator </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/surveillance/ class=md-nav__link> <span class=md-ellipsis> Surveillance </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/telegram-bot-api/ class=md-nav__link> <span class=md-ellipsis> Telegram Bot API </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/text-to-speech/ class=md-nav__link> <span class=md-ellipsis> Text-to-Speech </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/transformer/ class=md-nav__link> <span class=md-ellipsis> Transformer </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/ubuntu/ class=md-nav__link> <span class=md-ellipsis> Ubuntu </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/wsl/ class=md-nav__link> <span class=md-ellipsis> WSL </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/whoosh/ class=md-nav__link> <span class=md-ellipsis> Whoosh </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/windows/ class=md-nav__link> <span class=md-ellipsis> Windows </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a class=md-nav__link href=#introduction> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#the-concept> <span class=md-ellipsis> The Concept </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#technical-breakdown> <span class=md-ellipsis> Technical Breakdown </span> </a> <nav aria-label="Technical Breakdown" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#core-technologies> <span class=md-ellipsis> Core Technologies </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#script-structure> <span class=md-ellipsis> Script Structure </span> </a> <nav aria-label="Script Structure" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#databasemanager-class> <span class=md-ellipsis> DatabaseManager Class </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#facebookmarketplacescraper-class> <span class=md-ellipsis> FacebookMarketplaceScraper Class </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#asynchronous-operation> <span class=md-ellipsis> Asynchronous Operation </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#deep-dive-into-code> <span class=md-ellipsis> Deep Dive into Code </span> </a> <nav aria-label="Deep Dive into Code" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#setting-up-logging> <span class=md-ellipsis> Setting Up Logging </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#database-operations> <span class=md-ellipsis> Database Operations </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#data-scraping-and-parsing> <span class=md-ellipsis> Data Scraping and Parsing </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#handling-asynchronous-tasks> <span class=md-ellipsis> Handling Asynchronous Tasks </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#usage-scenario> <span class=md-ellipsis> Usage Scenario </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#challenges-and-solutions> <span class=md-ellipsis> Challenges and Solutions </span> </a> <nav aria-label="Challenges and Solutions" class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#challenge-scraping-dynamic-content> <span class=md-ellipsis> Challenge: Scraping Dynamic Content </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#solution-smartproxy> <span class=md-ellipsis> Solution: Smartproxy </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#challenge-parsing-html-content> <span class=md-ellipsis> Challenge: Parsing HTML Content </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#solution-regular-expressions> <span class=md-ellipsis> Solution: Regular Expressions </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#challenge-data-storage> <span class=md-ellipsis> Challenge: Data Storage </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#solution-databasemanager-class> <span class=md-ellipsis> Solution: DatabaseManager Class </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a class=md-nav__link href=#future-enhancements> <span class=md-ellipsis> Future Enhancements </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#conclusion> <span class=md-ellipsis> Conclusion </span> </a> <nav aria-label=Conclusion class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a class=md-nav__link href=#github-repository> <span class=md-ellipsis> GitHub Repository </span> </a> </li> <li class=md-nav__item> <a class=md-nav__link href=#disclaimer> <span class=md-ellipsis> Disclaimer </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <div><h1 id=advanced-python-scripting-scraping-and-storing-facebook-marketplace-vehicle-listings-in-canada>Advanced Python Scripting: Scraping and Storing Facebook Marketplace Vehicle Listings in Canada</h1> <h2 id=introduction>Introduction</h2> <p>In the realm of data collection and analysis, web scraping stands as a powerful tool to gather specific information from vast online sources. This blog post delves into a Python script I developed, focusing on scraping vehicle listings from Facebook Marketplace in Canadian cities and systematically storing the data in a SQL database. This tool exemplifies how Python's versatility can be harnessed for complex web scraping and data management tasks.</p> <h2 id=the-concept>The Concept</h2> <p>The script addresses a common challenge faced by many - accessing structured data from unstructured web sources like Facebook Marketplace. By automating the process of data extraction and storage, the script serves a variety of purposes, from market research to personal data aggregation.</p> <h2 id=technical-breakdown>Technical Breakdown</h2> <h3 id=core-technologies>Core Technologies</h3> <ul> <li><strong>Python</strong>: A versatile programming language ideal for scripting and automation.</li> <li><strong>BeautifulSoup</strong>: A Python library for parsing HTML and XML documents.</li> <li><strong>SQLite</strong>: A lightweight, disk-based database that doesn't require a separate server process.</li> <li><strong>Asyncio</strong>: Pythons built-in library for writing concurrent code using the async/await syntax.</li> </ul> <h3 id=script-structure>Script Structure</h3> <h4 id=databasemanager-class>DatabaseManager Class</h4> <p>This class forms the backbone of the data storage mechanism, handling all interactions with the SQLite database. It ensures data integrity and efficient data handling. </p><div class=highlight><pre><span></span><code>    <span class=k>class</span> <span class=nc>DatabaseManager</span><span class=p>:</span>
        <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>conn</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s1>'market_listings.db'</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>cursor</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>_prepare_database</span><span class=p>()</span>

        <span class=k>def</span> <span class=nf>_prepare_database</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<span class=w>            </span><span class=sd>"""Create the database table if it does not exist."""</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s1>'''</span>
<span class=s1>                CREATE TABLE IF NOT EXISTS market_listings (</span>
<span class=s1>                    id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class=s1>                    title TEXT NOT NULL,</span>
<span class=s1>                    mileage REAL,</span>
<span class=s1>                    price REAL NOT NULL,</span>
<span class=s1>                    location TEXT NOT NULL,</span>
<span class=s1>                    url TEXT NOT NULL UNIQUE,</span>
<span class=s1>                    image TEXT,</span>
<span class=s1>                    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>
<span class=s1>                )</span>
<span class=s1>            '''</span><span class=p>)</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>

        <span class=k>def</span> <span class=nf>listing_exists</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>url</span><span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>"SELECT COUNT(1) FROM market_listings WHERE url = ?"</span><span class=p>,</span> <span class=p>(</span><span class=n>url</span><span class=p>,))</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>cursor</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span> <span class=o>&gt;</span> <span class=mi>0</span>

        <span class=k>def</span> <span class=nf>create_market_listing</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>title</span><span class=p>,</span> <span class=n>mileage</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>location</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>image</span><span class=p>):</span>
            <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>listing_exists</span><span class=p>(</span><span class=n>url</span><span class=p>):</span>
                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Listing with URL </span><span class=si>{</span><span class=n>url</span><span class=si>}</span><span class=s2> already exists. Skipping insert."</span><span class=p>)</span>
                <span class=k>return</span> <span class=kc>None</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s1>'''</span>
<span class=s1>                    INSERT INTO market_listings (title, mileage, price, location, url, image)</span>
<span class=s1>                    VALUES (?, ?, ?, ?, ?, ?)</span>
<span class=s1>                '''</span><span class=p>,</span> <span class=p>(</span><span class=n>title</span><span class=p>,</span> <span class=n>mileage</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>location</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>image</span><span class=p>))</span>
                <span class=bp>self</span><span class=o>.</span><span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
                <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>cursor</span><span class=o>.</span><span class=n>lastrowid</span>
            <span class=k>except</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>IntegrityError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
                <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Unique constraint failed while inserting into database: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
                <span class=k>return</span> <span class=kc>None</span>
            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
                <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>"An error occurred while inserting into database: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
                <span class=k>return</span> <span class=kc>None</span>

        <span class=k>def</span> <span class=nf>retrieve_all_listings</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>"SELECT * FROM market_listings"</span><span class=p>)</span>
            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>cursor</span><span class=o>.</span><span class=n>fetchall</span><span class=p>()</span>

        <span class=k>def</span> <span class=nf>close_connection</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</code></pre></div> <h4 id=facebookmarketplacescraper-class>FacebookMarketplaceScraper Class</h4> <p>The scraper class is the script's workhorse, responsible for sending HTTP requests, parsing the received HTML, and extracting the necessary data from the Facebook Marketplace. </p><div class=highlight><pre><span></span><code>    <span class=k>class</span> <span class=nc>FacebookMarketplaceScraper</span><span class=p>:</span>
        <span class=k>def</span> <span class=o>**</span><span class=n>init</span><span class=o>**</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>city</span><span class=p>,</span> <span class=n>query</span><span class=p>,</span> <span class=n>db_manager</span><span class=p>):</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>city</span> <span class=o>=</span> <span class=n>city</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>query</span> <span class=o>=</span> <span class=n>query</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>db_manager</span> <span class=o>=</span> <span class=n>db_manager</span>

        <span class=k>def</span> <span class=nf>scrape_city</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>city</span><span class=p>,</span> <span class=n>query</span><span class=p>):</span>
<span class=w>            </span><span class=sd>"""Scrape a single city."""</span>
            <span class=n>url</span> <span class=o>=</span> <span class=s2>"https://scraper-api.smartproxy.com/v2/scrape"</span>
            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Scraping </span><span class=si>{</span><span class=n>city</span><span class=si>}</span><span class=s2>."</span><span class=p>)</span>
            <span class=n>payload</span> <span class=o>=</span> <span class=p>{</span>
                <span class=s2>"target"</span><span class=p>:</span> <span class=s2>"universal"</span><span class=p>,</span>
                <span class=s2>"locale"</span><span class=p>:</span> <span class=s2>"en-US"</span><span class=p>,</span>
                <span class=s2>"device_type"</span><span class=p>:</span> <span class=s2>"desktop"</span><span class=p>,</span>
                <span class=s2>"headless"</span><span class=p>:</span> <span class=s2>"html"</span><span class=p>,</span>
                <span class=s2>"url"</span><span class=p>:</span> <span class=sa>f</span><span class=s2>"https://www.facebook.com/marketplace/</span><span class=si>{</span><span class=n>city</span><span class=si>}</span><span class=s2>/search/?query=</span><span class=si>{</span><span class=n>query</span><span class=si>}</span><span class=s2>&amp;exact=false"</span><span class=p>,</span>
            <span class=p>}</span>
            <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
                <span class=s2>"accept"</span><span class=p>:</span> <span class=s2>"application/json"</span><span class=p>,</span>
                <span class=s2>"content-type"</span><span class=p>:</span> <span class=s2>"application/json"</span><span class=p>,</span>
                <span class=s2>"authorization"</span><span class=p>:</span> <span class=s2>"YOUR_API_KEY"</span><span class=p>,</span>
            <span class=p>}</span>

            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"payload: </span><span class=si>{</span><span class=n>payload</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"headers: </span><span class=si>{</span><span class=n>headers</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>

            <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>payload</span><span class=p>),</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>

            <span class=c1># Get the enitre response</span>
            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"response.text: </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"response.status_code: </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>

            <span class=c1># Get the JSON response</span>
            <span class=n>json_response</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>

            <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>content</span> <span class=o>==</span> <span class=s2>"null"</span><span class=p>:</span>
                <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span>
                    <span class=sa>f</span><span class=s2>"Error while scraping: </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>, </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=si>}</span><span class=s2>"</span>
                <span class=p>)</span>
                <span class=k>return</span> <span class=p>[]</span>

            <span class=k>try</span><span class=p>:</span>
                <span class=n>json_response</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
            <span class=k>except</span> <span class=ne>ValueError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
                <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Error decoding JSON: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
                <span class=k>return</span> <span class=p>[]</span>

            <span class=n>listings_content</span> <span class=o>=</span> <span class=n>json_response</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>"results"</span><span class=p>,</span> <span class=p>[])</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>listings_content</span><span class=p>:</span>
                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>"No results found in the response."</span><span class=p>)</span>
                <span class=k>return</span> <span class=p>[]</span>

            <span class=n>first_result_content</span> <span class=o>=</span> <span class=n>listings_content</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>"content"</span><span class=p>)</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>first_result_content</span><span class=p>:</span>
                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>"No content found in the first result."</span><span class=p>)</span>
                <span class=k>return</span> <span class=p>[]</span>

            <span class=n>soup</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=n>first_result_content</span><span class=p>,</span> <span class=s2>"html.parser"</span><span class=p>)</span>
            <span class=n>soup_listings</span> <span class=o>=</span> <span class=n>soup</span><span class=o>.</span><span class=n>find_all</span><span class=p>(</span>
                <span class=s2>"div"</span><span class=p>,</span>
                <span class=n>class_</span><span class=o>=</span><span class=s2>"x9f619 x78zum5 x1r8uery xdt5ytf x1iyjqo2 xs83m0k x1e558r4 x150jy0e x1iorvi4 xjkvuk6 xnpuxes x291uyu x1uepa24"</span><span class=p>,</span>
            <span class=p>)</span>

            <span class=k>if</span> <span class=ow>not</span> <span class=n>soup_listings</span><span class=p>:</span>
                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>"No listings found in the parsed HTML."</span><span class=p>)</span>
                <span class=k>return</span> <span class=p>[]</span>

            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Found </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>soup_listings</span><span class=p>)</span><span class=si>}</span><span class=s2> listings."</span><span class=p>)</span>
            <span class=k>return</span> <span class=n>soup_listings</span>

        <span class=k>def</span> <span class=nf>parse_listings</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>soup_listings</span><span class=p>):</span>
            <span class=n>new_listings</span> <span class=o>=</span> <span class=p>[]</span>  <span class=c1># Initialize an empty list to collect new listings</span>
            <span class=k>for</span> <span class=n>soup_listing</span> <span class=ow>in</span> <span class=n>soup_listings</span><span class=p>:</span>
                <span class=c1># Extract data from each listing</span>
                <span class=k>try</span><span class=p>:</span>
                    <span class=c1># Extract price using regex</span>
                    <span class=n>price</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>extract_price</span><span class=p>(</span><span class=n>soup_listing</span><span class=p>)</span>

                    <span class=c1># Extract mileage using regex</span>
                    <span class=n>mileage</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>extract_mileage</span><span class=p>(</span><span class=n>soup_listing</span><span class=p>)</span>

                    <span class=c1># Extract title</span>
                    <span class=n>title</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>extract_title</span><span class=p>(</span><span class=n>soup_listing</span><span class=p>)</span>

                    <span class=c1># Extract image URL</span>
                    <span class=n>image</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>extract_image</span><span class=p>(</span><span class=n>soup_listing</span><span class=p>)</span>

                    <span class=c1># Extract location</span>
                    <span class=n>location</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>extract_location</span><span class=p>(</span><span class=n>soup_listing</span><span class=p>)</span>

                    <span class=c1># Extract post URL</span>
                    <span class=n>post_url</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>extract_post_url</span><span class=p>(</span><span class=n>soup_listing</span><span class=p>)</span>

                    <span class=c1># Validate extracted data</span>
                    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_valid_listing</span><span class=p>(</span><span class=n>title</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>location</span><span class=p>,</span> <span class=n>post_url</span><span class=p>):</span>
                        <span class=k>continue</span>

                    <span class=c1># Check if the listing already exists in the database</span>
                    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_manager</span><span class=o>.</span><span class=n>listing_exists</span><span class=p>(</span><span class=n>post_url</span><span class=p>):</span>
                        <span class=k>continue</span>

                    <span class=c1># Add new listing to the database</span>
                    <span class=n>listing_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_manager</span><span class=o>.</span><span class=n>create_market_listing</span><span class=p>(</span>
                        <span class=n>title</span><span class=p>,</span> <span class=n>mileage</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>location</span><span class=p>,</span> <span class=n>post_url</span><span class=p>,</span> <span class=n>image</span>
                    <span class=p>)</span>
                    <span class=k>if</span> <span class=n>listing_id</span><span class=p>:</span>
                        <span class=n>new_listings</span><span class=o>.</span><span class=n>append</span><span class=p>(</span>
                            <span class=p>(</span><span class=n>title</span><span class=p>,</span> <span class=n>mileage</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>location</span><span class=p>,</span> <span class=n>post_url</span><span class=p>,</span> <span class=n>image</span><span class=p>)</span>
                        <span class=p>)</span>
                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
                    <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Error processing listing: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
                    <span class=k>continue</span>
            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Found </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>new_listings</span><span class=p>)</span><span class=si>}</span><span class=s2> new listings."</span><span class=p>)</span>
            <span class=k>return</span> <span class=n>new_listings</span>

        <span class=k>def</span> <span class=nf>extract_price</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>soup_listing</span><span class=p>):</span>
            <span class=n>text</span> <span class=o>=</span> <span class=n>soup_listing</span><span class=o>.</span><span class=n>get_text</span><span class=p>(</span><span class=n>strip</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

            <span class=c1># Match prices potentially followed by a year in the range 1950-2024</span>
            <span class=n>price_match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s2>"(\$\d{1,3}(?:,\d</span><span class=si>{3}</span><span class=s2>)?)(?=(1950|19[6-9]\d|20[0-1]\d|202[0-4])?)"</span><span class=p>,</span> <span class=n>text</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>price_match</span><span class=p>:</span>
                <span class=k>return</span> <span class=n>price_match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>

            <span class=c1># If the above pattern does not match, fall back to the original patterns</span>
            <span class=c1># Canadian dollar sign, without year</span>
            <span class=n>price_match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s2>"(\$\d+,\d+)"</span><span class=p>,</span> <span class=n>text</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>price_match</span><span class=p>:</span>
                <span class=k>return</span> <span class=n>price_match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>

            <span class=c1># US dollar sign, without year</span>
            <span class=n>price_match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s2>"(\$\d+)"</span><span class=p>,</span> <span class=n>text</span><span class=p>)</span>
            <span class=k>if</span> <span class=n>price_match</span><span class=p>:</span>
                <span class=k>return</span> <span class=n>price_match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>

            <span class=k>return</span> <span class=kc>None</span>

        <span class=k>def</span> <span class=nf>extract_mileage</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>soup_listing</span><span class=p>):</span>
            <span class=n>mileage_match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>r</span><span class=s2>"(\d+K) km"</span><span class=p>,</span> <span class=n>soup_listing</span><span class=o>.</span><span class=n>get_text</span><span class=p>(</span><span class=n>strip</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
            <span class=k>return</span> <span class=n>mileage_match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=k>if</span> <span class=n>mileage_match</span> <span class=k>else</span> <span class=kc>None</span>

        <span class=k>def</span> <span class=nf>extract_title</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>soup_listing</span><span class=p>):</span>
            <span class=n>title_elem</span> <span class=o>=</span> <span class=n>soup_listing</span><span class=o>.</span><span class=n>find</span><span class=p>(</span>
                <span class=s2>"span"</span><span class=p>,</span> <span class=n>class_</span><span class=o>=</span><span class=s2>"x1lliihq x6ikm8r x10wlt62 x1n2onr6"</span>
            <span class=p>)</span>
            <span class=k>return</span> <span class=n>title_elem</span><span class=o>.</span><span class=n>get_text</span><span class=p>(</span><span class=n>strip</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=k>if</span> <span class=n>title_elem</span> <span class=k>else</span> <span class=kc>None</span>

        <span class=k>def</span> <span class=nf>extract_image</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>soup_listing</span><span class=p>):</span>
            <span class=n>image_elem</span> <span class=o>=</span> <span class=n>soup_listing</span><span class=o>.</span><span class=n>find</span><span class=p>(</span>
                <span class=s2>"img"</span><span class=p>,</span> <span class=n>class_</span><span class=o>=</span><span class=s2>"xt7dq6l xl1xv1r x6ikm8r x10wlt62 xh8yej3"</span>
            <span class=p>)</span>
            <span class=k>return</span> <span class=n>image_elem</span><span class=p>[</span><span class=s2>"src"</span><span class=p>]</span> <span class=k>if</span> <span class=n>image_elem</span> <span class=k>else</span> <span class=kc>None</span>

        <span class=k>def</span> <span class=nf>extract_location</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>soup_listing</span><span class=p>):</span>
            <span class=c1># Extract location in the form of an Uppercase followed by Lowercase letters until a comma is found and than two uppercase letters</span>
            <span class=n>location_match</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span>
                <span class=sa>r</span><span class=s2>"([A-Z][a-z]+(?: [A-Z][a-z]+)*), [A-Z]</span><span class=si>{2}</span><span class=s2>"</span><span class=p>,</span>
                <span class=n>soup_listing</span><span class=o>.</span><span class=n>get_text</span><span class=p>(</span><span class=n>strip</span><span class=o>=</span><span class=kc>True</span><span class=p>),</span>
            <span class=p>)</span>
            <span class=n>location</span> <span class=o>=</span> <span class=n>location_match</span><span class=o>.</span><span class=n>group</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=k>if</span> <span class=n>location_match</span> <span class=k>else</span> <span class=kc>None</span>
            <span class=k>return</span> <span class=n>location</span>

        <span class=k>def</span> <span class=nf>extract_post_url</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>soup_listing</span><span class=p>):</span>
            <span class=n>url_elem</span> <span class=o>=</span> <span class=n>soup_listing</span><span class=o>.</span><span class=n>find</span><span class=p>(</span>
                <span class=s2>"a"</span><span class=p>,</span>
                <span class=n>class_</span><span class=o>=</span><span class=s2>"x1i10hfl xjbqb8w x6umtig x1b1mbwd xaqea5y xav7gou x9f619 x1ypdohk xt0psk2 xe8uvvx xdj266r x11i5rnm xat24cr x1mh8g0r xexx8yu           x4uap5 x18d9i69 xkhd6sd x16tdsg8 x1hl2dhg xggy1nq x1a2a7pz x1heor9g x1lku1pv"</span><span class=p>,</span>
            <span class=p>)</span>
            <span class=k>return</span> <span class=s2>"https://www.facebook.com"</span> <span class=o>+</span> <span class=n>url_elem</span><span class=p>[</span><span class=s2>"href"</span><span class=p>]</span> <span class=k>if</span> <span class=n>url_elem</span> <span class=k>else</span> <span class=kc>None</span>

        <span class=k>def</span> <span class=nf>is_valid_listing</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>title</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>location</span><span class=p>,</span> <span class=n>url</span><span class=p>):</span>
            <span class=c1># Log why a listing is invalid if it is</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>title</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>price</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>location</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>url</span><span class=p>:</span>
                <span class=n>missing_info</span> <span class=o>=</span> <span class=p>[]</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>title</span><span class=p>:</span>
                    <span class=n>missing_info</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>"title"</span><span class=p>)</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>price</span><span class=p>:</span>
                    <span class=n>missing_info</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>"price"</span><span class=p>)</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>location</span><span class=p>:</span>
                    <span class=n>missing_info</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>"location"</span><span class=p>)</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>url</span><span class=p>:</span>
                    <span class=n>missing_info</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>"url"</span><span class=p>)</span>
                <span class=c1># If all four are missing, go to the next listing without logging</span>
                <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>missing_info</span><span class=p>)</span> <span class=o>==</span> <span class=mi>4</span><span class=p>:</span>
                    <span class=k>pass</span>
            <span class=c1># Check if the listing is valid</span>
            <span class=n>is_valid</span> <span class=o>=</span> <span class=n>title</span> <span class=ow>and</span> <span class=n>price</span> <span class=ow>and</span> <span class=n>location</span> <span class=ow>and</span> <span class=n>url</span>
            <span class=k>if</span> <span class=ow>not</span> <span class=n>is_valid</span><span class=p>:</span>
                <span class=k>pass</span>
            <span class=k>return</span> <span class=n>is_valid</span>
</code></pre></div> <h4 id=asynchronous-operation>Asynchronous Operation</h4> <p>Utilizing asyncio, the script is capable of performing scraping operations at predetermined intervals, allowing for up-to-date data collection without manual intervention. </p><div class=highlight><pre><span></span><code>    <span class=k>async</span> <span class=k>def</span> <span class=nf>scrape_city_and_save_periodically</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>city</span><span class=p>,</span> <span class=n>query</span><span class=p>,</span> <span class=n>interval</span><span class=p>,</span> <span class=n>duration</span><span class=p>):</span>
        <span class=n>start_time</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Starting periodic scraping at </span><span class=si>{</span><span class=n>start_time</span><span class=si>}</span><span class=s2>."</span><span class=p>)</span>
        <span class=n>end_time</span> <span class=o>=</span> <span class=n>start_time</span> <span class=o>+</span> <span class=n>timedelta</span><span class=p>(</span><span class=n>hours</span><span class=o>=</span><span class=n>duration</span><span class=p>)</span>
        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Periodic scraping will end at </span><span class=si>{</span><span class=n>end_time</span><span class=si>}</span><span class=s2>."</span><span class=p>)</span>
        <span class=k>while</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span> <span class=o>&lt;</span> <span class=n>end_time</span><span class=p>:</span>
            <span class=k>try</span><span class=p>:</span>
                <span class=c1># Scrape the city</span>
                <span class=n>soup_listings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>scrape_city</span><span class=p>(</span><span class=n>city</span><span class=p>,</span> <span class=n>query</span><span class=p>)</span>
                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Scraped </span><span class=si>{</span><span class=n>city</span><span class=si>}</span><span class=s2> at </span><span class=si>{</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=si>}</span><span class=s2>."</span><span class=p>)</span>
                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Scraped </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>soup_listings</span><span class=p>)</span><span class=si>}</span><span class=s2> listings."</span><span class=p>)</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>soup_listings</span><span class=p>:</span>
                    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>"No listings found to process."</span><span class=p>)</span>
                    <span class=k>continue</span>
                <span class=c1># Parse the listings</span>
                <span class=n>new_listings</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>parse_listings</span><span class=p>(</span><span class=n>soup_listings</span><span class=p>)</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>new_listings</span><span class=p>:</span>
                    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>"No new listings found to upload."</span><span class=p>)</span>
                    <span class=k>continue</span>
                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Found </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>new_listings</span><span class=p>)</span><span class=si>}</span><span class=s2> new listings."</span><span class=p>)</span>
                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"new_listings: </span><span class=si>{</span><span class=n>new_listings</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
                <span class=c1># Upload the listings to SQL database</span>
                <span class=k>for</span> <span class=n>new_listing</span> <span class=ow>in</span> <span class=n>new_listings</span><span class=p>:</span>
                    <span class=n>title</span><span class=p>,</span> <span class=n>mileage</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>location</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>image</span> <span class=o>=</span> <span class=n>new_listing</span>
                    <span class=c1># Upload the listing to the database</span>
                    <span class=n>listing_id</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>db_manager</span><span class=o>.</span><span class=n>create_market_listing</span><span class=p>(</span>
                        <span class=n>title</span><span class=p>,</span> <span class=n>mileage</span><span class=p>,</span> <span class=n>price</span><span class=p>,</span> <span class=n>location</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>image</span>
                    <span class=p>)</span>
                    <span class=k>if</span> <span class=n>listing_id</span><span class=p>:</span>
                        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Uploaded listing </span><span class=si>{</span><span class=n>listing_id</span><span class=si>}</span><span class=s2> to database."</span><span class=p>)</span>
                    <span class=k>else</span><span class=p>:</span>
                        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Failed to upload listing </span><span class=si>{</span><span class=n>listing_id</span><span class=si>}</span><span class=s2> to database."</span><span class=p>)</span>
            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
                <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Error while scraping: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
                <span class=k>continue</span>
            <span class=k>finally</span><span class=p>:</span>
                <span class=c1># Wait for the specified interval</span>
                <span class=k>await</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=n>interval</span><span class=p>)</span>
</code></pre></div> <h3 id=deep-dive-into-code>Deep Dive into Code</h3> <h4 id=setting-up-logging>Setting Up Logging</h4> <p>Effective logging is crucial for monitoring the script's performance and debugging. The script is configured to log both to a file and the console, ensuring comprehensive tracking of events. </p><div class=highlight><pre><span></span><code>    <span class=c1># Set up logging    </span>
    <span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=o>**</span><span class=n>name</span><span class=o>**</span><span class=p>)</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>setLevel</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>)</span>

    <span class=n>file_handler</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>FileHandler</span><span class=p>(</span><span class=s2>"scraper.log"</span><span class=p>)</span>
    <span class=n>log_format</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>Formatter</span><span class=p>(</span>
    <span class=s2>"</span><span class=si>%(asctime)s</span><span class=s2> - </span><span class=si>%(name)s</span><span class=s2> - [</span><span class=si>%(levelname)s</span><span class=s2>] [</span><span class=si>%(pathname)s</span><span class=s2>:</span><span class=si>%(lineno)d</span><span class=s2>] - </span><span class=si>%(message)s</span><span class=s2> - [</span><span class=si>%(process)d</span><span class=s2>:</span><span class=si>%(thread)d</span><span class=s2>]"</span>
    <span class=p>)</span>
    <span class=n>file_handler</span><span class=o>.</span><span class=n>setFormatter</span><span class=p>(</span><span class=n>log_format</span><span class=p>)</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>addHandler</span><span class=p>(</span><span class=n>file_handler</span><span class=p>)</span>

    <span class=n>console_handler</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>StreamHandler</span><span class=p>()</span>
    <span class=n>console_handler</span><span class=o>.</span><span class=n>setFormatter</span><span class=p>(</span><span class=n>log_format</span><span class=p>)</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>addHandler</span><span class=p>(</span><span class=n>console_handler</span><span class=p>)</span>

    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>"Logger initialized."</span><span class=p>)</span>
</code></pre></div> <h4 id=database-operations>Database Operations</h4> <p>The script initializes the database and defines a schema for storing listing data. It includes robust error handling and data validation to maintain database integrity.</p> <div class=highlight><pre><span></span><code>    <span class=c1># Initialize the database</span>
    <span class=n>db_manager</span> <span class=o>=</span> <span class=n>DatabaseManager</span><span class=p>()</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>"Database initialized."</span><span class=p>)</span>

    <span class=c1># Create a table for storing market listings</span>
    <span class=n>db_manager</span><span class=o>.</span><span class=n>create_market_listings_table</span><span class=p>()</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>"Market listings table created."</span><span class=p>)</span>

    <span class=c1># Retrieve all listings from the database</span>
    <span class=n>listings</span> <span class=o>=</span> <span class=n>db_manager</span><span class=o>.</span><span class=n>retrieve_all_listings</span><span class=p>()</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Retrieved </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>listings</span><span class=p>)</span><span class=si>}</span><span class=s2> listings from the database."</span><span class=p>)</span>
</code></pre></div> <h4 id=data-scraping-and-parsing>Data Scraping and Parsing</h4> <p>The script makes use of BeautifulSoup to parse HTML content fetched from Facebook Marketplace. It navigates the DOM structure to extract details such as title, price, and location of the vehicle listings. </p><div class=highlight><pre><span></span><code>    <span class=c1># Scrape the city</span>
    <span class=n>soup_listings</span> <span class=o>=</span> <span class=n>scraper</span><span class=o>.</span><span class=n>scrape_city</span><span class=p>(</span><span class=n>city</span><span class=p>,</span> <span class=n>query</span><span class=p>)</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Scraped </span><span class=si>{</span><span class=n>city</span><span class=si>}</span><span class=s2> at </span><span class=si>{</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=si>}</span><span class=s2>."</span><span class=p>)</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Scraped </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>soup_listings</span><span class=p>)</span><span class=si>}</span><span class=s2> listings."</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>soup_listings</span><span class=p>:</span>
        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>"No listings found to process."</span><span class=p>)</span>
        <span class=k>continue</span>
    <span class=c1># Parse the listings</span>
    <span class=n>new_listings</span> <span class=o>=</span> <span class=n>scraper</span><span class=o>.</span><span class=n>parse_listings</span><span class=p>(</span><span class=n>soup_listings</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>new_listings</span><span class=p>:</span>
        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>"No new listings found to upload."</span><span class=p>)</span>
        <span class=k>continue</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"Found </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>new_listings</span><span class=p>)</span><span class=si>}</span><span class=s2> new listings."</span><span class=p>)</span>
    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>"new_listings: </span><span class=si>{</span><span class=n>new_listings</span><span class=si>}</span><span class=s2>"</span><span class=p>)</span>
</code></pre></div> <h4 id=handling-asynchronous-tasks>Handling Asynchronous Tasks</h4> <p>The script utilizes asyncio to perform scraping operations at predetermined intervals. This allows for up-to-date data collection without manual intervention. </p><div class=highlight><pre><span></span><code>    <span class=c1># Scrape the city and save periodically</span>
    <span class=n>loop</span> <span class=o>=</span> <span class=n>asyncio</span><span class=o>.</span><span class=n>get_event_loop</span><span class=p>()</span>
    <span class=n>loop</span><span class=o>.</span><span class=n>run_until_complete</span><span class=p>(</span>
        <span class=n>scraper</span><span class=o>.</span><span class=n>scrape_city_and_save_periodically</span><span class=p>(</span><span class=n>city</span><span class=p>,</span> <span class=n>query</span><span class=p>,</span> <span class=n>interval</span><span class=p>,</span> <span class=n>duration</span><span class=p>)</span>
    <span class=p>)</span>
    <span class=n>loop</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</code></pre></div> <h2 id=usage-scenario>Usage Scenario</h2> <p>The script can be used to collect data for a variety of purposes, from market research to personal data aggregation. It can be adapted to scrape data from other Facebook Marketplace categories and locations.</p> <h2 id=challenges-and-solutions>Challenges and Solutions</h2> <h3 id=challenge-scraping-dynamic-content>Challenge: Scraping Dynamic Content</h3> <p>Facebook Marketplace is a dynamic website that loads content dynamically using JavaScript. This makes it difficult to scrape using traditional methods.</p> <h3 id=solution-smartproxy>Solution: Smartproxy</h3> <p>Smartproxy is a rotating residential proxy network that allows you to send requests from a pool of over 40 million residential proxies. This allows you to bypass anti-scraping measures and scrape dynamic content with ease.</p> <h3 id=challenge-parsing-html-content>Challenge: Parsing HTML Content</h3> <p>The script uses BeautifulSoup to parse HTML content fetched from Facebook Marketplace. It navigates the DOM structure to extract details such as title, price, and location of the vehicle listings.</p> <h3 id=solution-regular-expressions>Solution: Regular Expressions</h3> <p>Regular expressions are used to extract specific patterns from the HTML content. This allows for efficient and accurate data extraction.</p> <h3 id=challenge-data-storage>Challenge: Data Storage</h3> <p>The script uses SQLite to store the scraped data. It ensures data integrity and efficient data handling.</p> <h3 id=solution-databasemanager-class>Solution: DatabaseManager Class</h3> <p>The DatabaseManager class forms the backbone of the data storage mechanism, handling all interactions with the SQLite database. It ensures data integrity and efficient data handling.</p> <h2 id=future-enhancements>Future Enhancements</h2> <ul> <li><strong>Scrape Other Categories</strong>: The script can be adapted to scrape other categories of Facebook Marketplace, such as electronics and clothing.</li> <li><strong>Scrape Other Locations</strong>: The script can be adapted to scrape other locations of Facebook Marketplace, such as the United States and the United Kingdom.</li> <li><strong>Scrape Other Platforms</strong>: The script can be adapted to scrape other platforms, such as Kijiji and Craigslist.</li> </ul> <h2 id=conclusion>Conclusion</h2> <p>This Python script stands as a testament to the power of programming in automating and streamlining data collection processes. It is not just a tool but a framework that can be adapted to various other scraping needs, showcasing Python's flexibility and efficiency.</p> <h3 id=github-repository>GitHub Repository</h3> <p>For a detailed view of the code and to try it out, visit the GitHub repository: <a href=https://github.com/yourusername/your-repo-name>GitHub Link</a></p> <h3 id=disclaimer>Disclaimer</h3> <p>This tool is designed for educational and research purposes. Users must comply with Facebook's terms of service and applicable laws when scraping data.</p></div> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 3, 2024</span> <br> Created: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 3, 2024</span> </small> </div> <form class=md-feedback hidden name=feedback> <fieldset> <legend class=md-feedback__title> Was this page helpful? </legend> <div class=md-feedback__inner> <div class=md-feedback__list> <button class="md-feedback__icon md-icon" data-md-value=1 title="This page was helpful" type=submit> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"></path></svg> </button> <button class="md-feedback__icon md-icon" data-md-value=0 title="This page could be improved" type=submit> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"></path></svg> </button> </div> <div class=md-feedback__note> <div data-md-value=1 hidden> Thanks for your feedback! </div> <div data-md-value=0 hidden> Thanks for your feedback! Help us improve this page by using our <a href=YOUR_FEEDBACK_URL rel=noopener target=_blank>feedback form</a>. </div> </div> </div> </fieldset> </form> <style>
                .share-button:hover {
                    filter: brightness(1.2);
                }
                .share-buttons {
                    display: flex;
                    justify-content: flex-end;
                }
            </style> <div class=share-buttons> <button class=share-button onclick="window.open('https://twitter.com/intent/tweet?url=https://harminder.dev/projects/web-scraping/facebook/facebook-marketplace/smartproxy-facebook-marketplace-scraper', 'TwitterShare', 'width=550,height=680,menubar=no,toolbar=no'); return false;" style="background-color: #1da1f2; color: white; padding: 5px 10px; border-radius: 5px; margin-right: 10px; cursor: pointer; display: flex; align-items: center;"> <i class="fa-brands fa-twitter" style="margin-right: 5px;"></i> Tweet </button> <button class=share-button onclick="window.open('https://www.linkedin.com/shareArticle?url=https://harminder.dev/projects/web-scraping/facebook/facebook-marketplace/smartproxy-facebook-marketplace-scraper', 'LinkedinShare', 'width=550,height=730,menubar=no,toolbar=no'); return false;" style="background-color: #0077b5; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer; display: flex; align-items: center;"> <i class="fa-brands fa-linkedin" style="margin-right: 5px;"></i> Share </button> </div> <h2 id=__comments>Comments</h2> <script async crossorigin=anonymous data-category-id=DIC_kwDOKetpMs4Cas4f data-emit-metadata=1 data-input-position=top data-lang=en data-mapping=pathname data-reactions-enabled=0 data-repo=harmindersinghnijjar/kb-blog-portfolio-mkdocs data-repo-id=R_kgDOKetpMg data-strict=0 data-theme=dark src=https://giscus.app/client.js>
</script> </article> </div> </div> <button class="md-top md-icon" data-md-component=top hidden type=button> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg> Back to top </button> </main> <footer class=md-footer> <nav aria-label=Footer class="md-footer__inner md-grid"> <a aria-label="Previous: Oxylabs Facebook Marketplace Scraper" href=../oxylabs-facebook-marketplace-scraper/ class="md-footer__link md-footer__link--prev"> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Oxylabs Facebook Marketplace Scraper </div> </div> </a> <a aria-label="Next: 3D GitHub Contributions" href=../../../../websites/vercel/gitbute/3d-github-contributions/3d-github-contributions/ class="md-footer__link md-footer__link--next"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> 3D GitHub Contributions </div> </div> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright  2024 Harminder Singh Nijjar </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ rel=noopener target=_blank> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../../../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "navigation.top", "content.tooltips", "header.title", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../../../../assets/javascripts/bundle.cd18aaf1.min.js></script> <script src=https://cdn.jsdelivr.net/npm/apexcharts></script> <script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4024063910372726"></script> </body> </html>